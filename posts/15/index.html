
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Your wish is my command</title>
  <meta name="author" content="Choe, Cheng-Dae">

  
  <meta name="description" content="http://docs.djangoproject.com/en/1.3/topics/db/queries/#field-lookups 에 필터에 사용할 수 있는 것들이 있는데, 여기에 나와있지 않는 것들이 있다. django가 문서가 충실한 편이라 여기만 열라 뒤졌으나 원하는 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://whitekid.github.io/posts/15/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Your wish is my command" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3950194-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Your wish is my command</a></h1>
  
    <h2>It&#8217;s a long journey</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="whitekid.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/700">Django 문서에 나오지 않은 Filter Lookup</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-04-04T00:00:00+09:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://docs.djangoproject.com/en/1.3/topics/db/queries/#field-lookups">http://docs.djangoproject.com/en/1.3/topics/db/queries/#field-lookups</a> 에 필터에 사용할 수 있는 것들이 있는데, 여기에 나와있지 않는 것들이 있다. django가 문서가 충실한 편이라 여기만 열라 뒤졌으나 원하는 것 찾지못하고.. 설마 없겠어? 하고 소스코드를 뒤져보니 보인다&hellip; ^^;</p>

<p>django/models/sql/constants.py</p>

<ul>
<li>in</li>
<li>range</li>
<li>year, month, week_day,</li>
<li>search</li>
<li>regex</li>
</ul>


<p>추가: 근데 허탈하게도 문서에 있더라는&hellip; <a href="http://docs.djangoproject.com/en/1.3/ref/models/querysets/#field-lookups">http://docs.djangoproject.com/en/1.3/ref/models/querysets/#field-lookups</a></p>

<p>내가 찾던게 뭐냐고? in과 range다~ ㅋㅋ</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/696">Mako Expression Filtering, Decorator</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-04-02T00:00:00+09:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2><a href="http://www.makotemplates.org/docs/filtering.html#expression-filtering">http://www.makotemplates.org/docs/filtering.html#expression-filtering</a></h2>

<ul>
<li>u : URL escaping, provided by urllib.quote_plus(string.encode(&lsquo;utf-8&rsquo;))</li>
<li>h : HTML escaping, provided by markupsafe.escape(string) (new as of 0.3.4 - prior versions use cgi.escape(string, True))</li>
<li>x : XML escaping</li>
<li>trim : whitespace trimming, provided by string.strip()</li>
<li>entity : produces HTML entity references for applicable strings, derived from htmlentitydefs</li>
<li>unicode (str on Python 3): produces a Python unicode string (this function is applied by default).</li>
<li>decode.<some encoding> : decode input into a Python unicode with the specified encoding</li>
<li>n : disable all default filtering; only filters specified in the local expression tag will be applied.</li>
</ul>


<p>필터는 그냥 스트링 인자를 하나 받는 함수이므로 작성하기도 편하다.</p>

<p>그런데 아쉽게도 필더에 파라미터가 들어가지 않는구나..</p>

<h2><a href="http://www.makotemplates.org/docs/filtering.html#decorating">http://www.makotemplates.org/docs/filtering.html#decorating</a></h2>

<p>mako의 함수에 python의 decorator처럼 사용할 수 있다. 멋진데?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/692">Django: request.user에 나만의 User를 넣기?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-31T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>음.. 제목이 이상하긴 한데&hellip; django의 authentication을 사용하면 request.user에 django.contrib.auth.models.User 객체가 생긴다. 그런데 말이다 처음부터 django를 사용할 경우는 이거 쓰면 되는데, 이미 돌아가는 프로젝트를 django로 옮겨가는 경우 django의 user가 맞지 않는게 있다.</p>

<p>first_name, last_name 등은 어쩌면 우리나라의 환경에 맞지 않는 것일 수 도 있고, username 보다는 userid가 더 알아먹기 편하니 말이다.. 물론 이미 기존 데이터베이스도 그렇게 되어있을 것이고&hellip;</p>

<p>이런 상황에서 request를 처리할때 django의 스타일과 다르게 user를 가져오는 것도.. 솔직히 맘에 들지 않는다. 남이 고민고민해서 만들어 놓은 것은 되도록이면 그들의 철학에 맞게 쓰자는게 나의 주의니깐&hellip;</p>

<p>그래서 고심끝에 request.user를 사용하되 request.user가 django가 지원하는 것이 아닌 나만의 custom user 모델로 생성하고, 그리고 몇몇 django에서 필요한 메소드의 함수만 만들어 주면 될 것이라 생각하고 작업했더니 아주 나이스하게 돌아긴다..~~</p>

<p>django.user를 설정하는 곳은 middleware이니 나도 새로운 middleware를 만들어서 처리했다. 물론 django authentication의 코드를 좀 참고했다. 대충 아래 코드 보시고&hellip;</p>

<pre><code>from myapp.models import AnonymousUser, User

class LazyUser(object):
    def __get__(self, request, obj_type = None):
        if not hasattr(request, '__user'):
            request.__user = User.objects.get(id=request.session['user_id']) if request.session.get('user_id', False) else AnonymousUser()
        return request.__user

class AuthenticationMiddleware:
    def process_request(self, request):
        if not hasattr(request.__class__, 'user') or not request.__class__.user is LazyUser:
            request.__class__.user = LazyUser()
</code></pre>

<p>이렇게하면 이제 request.user를 우리만의 user객체로 사용가능하니.. 좋다~</p>

<p>실제 작성했던 코드에서 대충 개념만 표현한 것이라 제대로 동작할 지는 나도 모른다.. ㅋㅋ</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/688">파라미터가 있는 Decorator</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-31T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Python의 Decorator 기능은 한마디로 멋지다. 잘 쓰면 유용하지&hellip; 근데 작성하면 항상 헷갈린단 말이지&hellip;</p>

<p>decorator에 파라미터를 넘겨주고자 하는 경우에도 상당히 헷갈린다. 파라미터가 없는 것하고 형태가 아주 또 달라지거든.. 간단히 기억하자 파라미터가 있는 데코레이터는 wrapp 함수를 한번 더 두어야한다는 것..</p>

<pre><code>def prefix_decorator(func):
        def new_func(*args, **kwargs):
                return 'prefix: ' + func(*args, **kwargs)
        return new_func

def my_decorator(str):
        def wrap(func):
                def new_func(*args, **kwargs):
                        return func(*args, **kwargs) + ' :' + str
                return new_func

        return wrap

@prefix_decorator
@my_decorator('added by decorator')
def test():
        return "I'm test"

print test()
</code></pre>

<p>실행 결과는 아래와 같음..</p>

<pre><code>prefix: I'm test :added by decorator
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/684">Python-mcrypt 사용 예</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-25T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://niemeyer.net/python-mcrypt">python-mcrypt</a>은 문서가 없다. 포함된 test.py를 보면 되는데&hellip; 좀 길고..</p>

<pre><code>#! -*- encoding: utf8 -*-
import base64
import urllib
import mcrypt
import random
import string

def random_string(length):
        return ''.join([random.choice(string.ascii_letters + string.digits) for x in range(length)])

chiper_key = random_string(16)

# encode
def encrypt(data):
        m = mcrypt.MCRYPT('rijndael-256', 'cfb')
        iv_size = m.get_iv_size()
        iv = random_string(iv_size)

        m.init(chiper_key, iv)
        return base64.b64encode(m.encrypt(iv + data))


# decode
def decrypt(data):
        data = base64.b64decode(data)
        m = mcrypt.MCRYPT('rijndael-256', 'cfb')
        iv_size = m.get_iv_size()
        iv = data[:iv_size]
        encrypted = data[iv_size:]
        m.init(chiper_key, iv)
        return m.decrypt(encrypted)

data = '안녕하세요'
assert data == decrypt(encrypt(data))
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/680">MySQL XXX_general_ci면&#8230;</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-22T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>MySQL에서 LIKE로 검색하는데 이놈이 대소문자를 구별하지 않고 검색하는거다. 이거 참 이놈은 ILIKE가 기본값인가? 하고 넘어갔었는데 오늘은 = 로 검색하는데도 대소문자를 구별하지 않고 검색하는거다&hellip; 나로썬 황당~</p>

<p>주위 분들게 물어봤더니 euckr_general_ci로 되어있으면 기본으로 대소문자를 구별하지 않는다고 한다. _cs면 대소문자를 구분한다나&hellip; ㅡㅡ</p>

<p>뭐 이런 일이&hellip; 하여간 이상한 MySQL이다.~</p>

<p>그럼 Case Sentive 검색을 하려면 어떻게 하느냐? euckr_general_ci는 Case Insentive로 되기때문에 _cs로 해야하는데 euckr_general_cs가 없다. 대신 euckr_bin이 있으니 그걸로 하면 된다.</p>

<pre><code>select field from table where field COLLATE euckr_bin = 'test string'
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/678">Cannot Write Mode P as JPEG</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-12T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>PIL로 이미지 썸내일 만드는데&hellip; 이런 에러가&hellip;</p>

<p><a href="http://www.errorhelp.com/search/details/80884/ioerror-cannot-write-mode-p-as-jpeg">http://www.errorhelp.com/search/details/80884/ioerror-cannot-write-mode-p-as-jpeg</a></p>

<p>간단하다.. P 모드가 아닌 RGB 모드로..</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/676">Google Task Sync</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-09T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://gmailblog.blogspot.com/2011/01/top-tasks-for-google-tasks.html">http://gmailblog.blogspot.com/2011/01/top-tasks-for-google-tasks.html</a></p>

<p>Tasks API and synchronization이 들어갔다. 이거 되면 정말 좋겠다. 얼른~</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/673">Ubuntu 휴지통 아이콘 보이기</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-03T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>이상하게 우분투 시스템에 휴지통 아이콘이 없어서 찾아봤더니 아래처럼 하면 휴지통이 보인다..</p>

<p><a href="http://www.howtogeek.com/howto/ubuntu/add-the-trash-can-icon-to-your-ubuntu-desktop/">http://www.howtogeek.com/howto/ubuntu/add-the-trash-can-icon-to-your-ubuntu-desktop/</a></p>

<p><a href="http://zodiac12k.egloos.com/1382797">http://zodiac12k.egloos.com/1382797</a></p>

<p>그리고 휴지통을 열었더니, 지금까지 삭제한 파일이 거의 5G가 있네&hellip; 숨어있는 5G를 찾았다.!</p>

<p>근데 왜? 삭제하면 휴지통으로 보내면서 휴지통이 기본으로 안보이게 한거야!!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/668">GeoIP Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-03-01T00:00:00+09:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.pointlessrants.com/2010/05/python-geoip-python-geoip-cities-tutorial/">http://www.pointlessrants.com/2010/05/python-geoip-python-geoip-cities-tutorial/</a></p>

<pre><code>import GeoIP
import socket

host = 'www.daum.net'

gi = GeoIP.new(GeoIP.GEOIP_MEMORY_CACHE)
print socket.gethostbyname(host), gi.country_code_by_name(host),

gi = GeoIP.open('GeoLiteCity.dat', GeoIP.GEOIP_STANDARD)
city = gi.record_by_name(host)
if city:
print city['city'], city['region_name']
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/16">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/14">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/07/cloud-computing-2-pic/">Cloud Computing 2 Pic</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/06/kubernetes-summary/">Kubernetes Review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/30/visualize-iptable-rules/">Security Group의 Rule이 어떤 순서로 적용되는지 보기</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/25/keystone-bootstrap/">Keystone Bootstrap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/25/neutron-default-security-group/">Neutron Default Security Group</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Choe, Cheng-Dae -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-woosum-net';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
